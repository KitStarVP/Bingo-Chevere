<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Test Compra</title>
</head>
<body>
    <h1>Test de Compra</h1>
    
    <input type="tel" id="phone" placeholder="04241234567" maxlength="11">
    <input type="text" id="ref" placeholder="1234" maxlength="4">
    <input type="number" id="qty" value="1" min="1">
    <button id="comprar">COMPRAR</button>
    
    <div id="resultado"></div>

    <!-- Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
      import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAKK_aY4OeEh4NmRIAExKk4T0i7d4Z1_8M",
        authDomain: "bingo-chevere.firebaseapp.com",
        databaseURL: "https://bingo-chevere-default-rtdb.firebaseio.com/",
        projectId: "bingo-chevere",
        storageBucket: "bingo-chevere.firebasestorage.app",
        messagingSenderId: "1057150163831",
        appId: "1:1057150163831:web:0d6e9f70c356ee56b09f72"
      };

      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      
      console.log('Firebase OK');
      
      document.getElementById('comprar').onclick = function() {
        const phone = document.getElementById('phone').value;
        const reference = document.getElementById('ref').value;
        const quantity = parseInt(document.getElementById('qty').value);
        
        if (phone.length !== 11 || reference.length !== 4) {
          alert('Datos incompletos');
          return;
        }
        
        const purchase = {
          id: Date.now(),
          ref: reference,
          amount: quantity * 60,
          cartones: quantity,
          phone: phone,
          date: new Date().toISOString().split('T')[0],
          status: 'pending',
          timestamp: Date.now()
        };
        
        console.log('Guardando:', purchase);
        
        set(ref(database, `purchases/${purchase.id}`), purchase)
          .then(() => {
            console.log('✅ ÉXITO');
            document.getElementById('resultado').innerHTML = '✅ Compra guardada en Firebase';
          })
          .catch(error => {
            console.error('❌ ERROR:', error);
            document.getElementById('resultado').innerHTML = '❌ Error: ' + error.message;
          });
      };
    </script>
</body>
</html>